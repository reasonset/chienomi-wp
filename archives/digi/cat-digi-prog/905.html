<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="PureBuilder Simply WP Importer" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <meta name="author" content="Masaki Haruka" />
    <meta name="date" content="2016-04-13T00:00:00+09:00" />
    <meta name="dcterms.date" content="2016-04-13T00:00:00+09:00" />
    <title>JavaScriptなんて必要なら自分で書けばいいじゃない - Chienomi</title>
    <style type="text/css">article {
max-width: 1080px;
margin: auto;
}</style>
  </head>
  <body>

    <section id="ContentContainer">
      <header id="MainHeader"><a href="/"><h1>Chienomi</h1></a></header>
      <section id="ArticleBox">
        <header id="ArticleTitle"><h1>JavaScriptなんて必要なら自分で書けばいいじゃない</h1></header>
        <article id="MainArticle">
<p>JavaScript、特にJQueryを多用する人の中に、妙なプログラミングスタイルでありながら、それに文句を言う人が結構いる。有名所では<a href="http://qiita.com/KDKTN/items/4c6986049d204f0645d8">Qiitaのコールバックを駆逐したい</a>とか。</p>

<p>JavaScriptはメタプログラミングが容易なので、自分で好きにいじれよ、別にフレームワークに依存する必要もないだろう、と思う。</p>

<p>では、同記事の課題から。</p>

<pre><code>$.get("hoge.txt", function(hoge){
    $.get("piyo.txt", function(piyo){
        console.log(hoge + piyo);
    });
});
</code></pre>

<p><code>$.get</code>が非同期で第一引数のファイルを読み、第二引数の関数をコールバックとして呼ぶものであるらしい。
だが、<code>$.get</code>を使う前提であれば次のような関数を用意しておけばいい。</p>

<pre><code>$my.gets = function(/ *** /) {
  var callback = arguments.pop
  var getfunctions
  var args = arguments

  if (arguments.length &lt; 2 )
    return undefined

  getfunctions = function() {
    $.get(args.pop, callback)
  }

  while (args.length &gt; 0) {
    getfunctions = function() {
      $.get(args.pop, getfunctions)
    }
  }

  getfunctions()
  return true

}
</code></pre>

<p>JavaScriptの無名関数はクロージャである。
外側にある同一のオブジェクトを参照することができるし、<code>getfuinctions</code>に代入される無名関数に書かれた<code>getfunctions</code>は代入される前の時点のオブジェクトである。</p>

<p>あとは簡単</p>

<pre><code>$my.gets("hoge.txt", "piyo.txt")
</code></pre>

<p>元記事はDRYに反するコードを連ねている。</p>

<p>メタプログラミング、リフレクション、ダックタイピング、そしてDRYを正しく意識を払えば、簡潔で美しいコードが見えてくるだろう。
上記の例はわかりやすさのために美しさを犠牲にした。</p>

<p>また、JavaScriptは配列も配列されていない。
例えば</p>

<pre><code>a[0] = "Foo"
a[10000] = "Bar"
</code></pre>

<p>としたところで、10001個のメモリが確保されるのではなく、2個確保されるだけだし、</p>

<pre><code>a.10000
</code></pre>

<p>のようにもアクセスできる。
<code>length</code>が問題にならないのであれば既存クラスにだって好きにいれて良い。
例えばHTML要素のオブジェクト(a <code>Element</code>)に対して</p>

<pre><code>elem._param_src = foo
</code></pre>

<p>のようにしても構わない。
(Element要素などは元のプロパティが多いし、いつ新しく入ったプロパティとバッティングするかわからないので、その点を考慮した書き方をしたほうが良い)</p>

<p>どんなオブジェクトにも適用できるので、先の例も</p>

<pre><code>$.get.seq = function() {
  / *** /
}
</code></pre>

<p>のようにすることもできる。こうした柔軟な発想も必要だ。</p>

<!-- PBSEARCH_RESULT -->
        </article>
    </section>
    <footer id="InfoFooter">
      <ul>
        <li>© Masaki Haruka 2003.</li>
        <li>Generated by <a href="https://gitlab.com/reasonset/pbsimply-wpimporter">PureBuilder Simply WP Importer</a></li>
      </ul>
    </footer>
  </body>
</html>
