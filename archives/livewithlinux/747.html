<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="PureBuilder Simply WP Importer" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <meta name="author" content="Masaki Haruka" />
    <meta name="date" content="2015-09-29T00:00:00+09:00" />
    <meta name="dcterms.date" content="2015-09-29T00:00:00+09:00" />
    <title>デフォルトのフォントの選ばれ方がおかしい - Chienomi</title>
    <style type="text/css">article {
max-width: 1080px;
margin: auto;
}</style>
  </head>
  <body>

    <section id="ContentContainer">
      <header id="MainHeader"><a href="/"><h1>Chienomi</h1></a></header>
      <section id="ArticleBox">
        <header id="ArticleTitle"><h1>デフォルトのフォントの選ばれ方がおかしい</h1></header>
        <article id="MainArticle">

<p>fonts.confは以下のようになっているのだが</p>

<pre><code>    &lt;?xml version='1.0'?&gt;
    &lt;!DOCTYPE fontconfig SYSTEM 'fonts.dtd'&gt;
    &lt;fontconfig&gt;
     &lt;match target="font"&gt;
      &lt;edit name="lcdfilter" mode="assign"&gt;
       &lt;const&gt;lcddefault&lt;/const&gt;
      &lt;/edit&gt;
     &lt;/match&gt;
     &lt;match target="pattern"&gt;
      &lt;test qual="any" name="family"&gt;
       &lt;string&gt;serif&lt;/string&gt;
      &lt;/test&gt;
      &lt;edit binding="strong" name="family" mode="assign"&gt;
       &lt;string&gt;HannariMincho&lt;/string&gt;
      &lt;/edit&gt;
     &lt;/match&gt;
     &lt;match target="pattern"&gt;
      &lt;test qual="any" name="family"&gt;
       &lt;string&gt;sans-serif&lt;/string&gt;
      &lt;/test&gt;
      &lt;edit binding="strong" name="family" mode="assign"&gt;
       &lt;string&gt;Migu 1P&lt;/string&gt;
      &lt;/edit&gt;
     &lt;/match&gt;
     &lt;match target="pattern"&gt;
      &lt;test qual="any" name="family"&gt;
       &lt;string&gt;sans&lt;/string&gt;
      &lt;/test&gt;
      &lt;edit binding="strong" name="family" mode="assign"&gt;
       &lt;string&gt;Migu 1P&lt;/string&gt;
      &lt;/edit&gt;
     &lt;/match&gt;
     &lt;match target="pattern"&gt;
      &lt;test qual="any" name="family"&gt;
       &lt;string&gt;monospace&lt;/string&gt;
      &lt;/test&gt;
      &lt;edit binding="strong" name="family" mode="assign"&gt;
       &lt;string&gt;Ricty Discord&lt;/string&gt;
      &lt;/edit&gt;
     &lt;/match&gt;
     &lt;match target="pattern"&gt;
      &lt;test qual="all" compare="not_eq" name="family"&gt;
       &lt;string&gt;sans-serif&lt;/string&gt;
      &lt;/test&gt;
      &lt;test qual="all" compare="not_eq" name="family"&gt;
       &lt;string&gt;serif&lt;/string&gt;
      &lt;/test&gt;
      &lt;test qual="all" compare="not_eq" name="family"&gt;
       &lt;string&gt;monospace&lt;/string&gt;
      &lt;/test&gt;
      &lt;edit name="family" mode="append_last"&gt;
       &lt;string&gt;sans-serif&lt;/string&gt;
      &lt;/edit&gt;
     &lt;/match&gt;
     &lt;dir&gt;~/.fonts&lt;/dir&gt;
    &lt;/fontconfig&gt;
</code></pre>

<p>なぜか、明示されていないフォントはラノベPOPになってしまう。
これはいくらなんでも可読性が低すぎるため、ラノベPOPのフォントファイルをリネームして後ろに回したところ、梅ゴシックになった。
しかし、依然としてボールドには梅ゴシックが使われる。</p>

<p>さらに、Skypeでは途中でフォントが変わったり、まぁ猛烈に読みづらい状態だ。</p>

<p>意味不明なことに、<code>not_eq</code>で<code>append_last</code>している部分は、</p>

<pre><code>     &lt;match target="pattern"&gt;
      &lt;test qual="all" compare="not_eq" name="family"&gt;
       &lt;string&gt;sans-serif&lt;/string&gt;
      &lt;/test&gt;
      &lt;test qual="all" compare="not_eq" name="family"&gt;
       &lt;string&gt;serif&lt;/string&gt;
      &lt;/test&gt;
      &lt;test qual="all" compare="not_eq" name="family"&gt;
       &lt;string&gt;monospace&lt;/string&gt;
      &lt;/test&gt;
      &lt;edit name="family" mode="assign" binding="same"&gt;
       &lt;string&gt;sans-serif&lt;/string&gt;
      &lt;/edit&gt;
     &lt;/match&gt;
</code></pre>

<p>とすると、今まで正しく表示されていたアプリケーションメニューが梅ゴシックになり、依然として<code>fc-match</code>すると梅ゴシックが返る。</p>

<p>このbindingを<code>strong</code>にしても結果は同じ、<code>week</code>だと単に無視される。</p>

<p>この問題には長く悩まされていたが、<code>sans-serif</code>でなく、実体(例えば<code>Migu 1P</code>)を指定すると反映された。</p>

<p>だが、CinnamonのUIについては改善せず、これは<code>~/.theme/&lt;theme&gt;/cinnamon/cinnamon.css</code>の<code>stage</code>要素に対して指定されているものを変更する必要があった。</p>

<p><code>sans-serif</code>を指定して動かない理由はわからず、その際の挙動についても理解に苦しむが、とりあえずここまで。</p>

<!-- PBSEARCH_RESULT -->
        </article>
    </section>
    <footer id="InfoFooter">
      <ul>
        <li>© Masaki Haruka 2003.</li>
        <li>Generated by <a href="https://gitlab.com/reasonset/pbsimply-wpimporter">PureBuilder Simply WP Importer</a></li>
      </ul>
    </footer>
  </body>
</html>
