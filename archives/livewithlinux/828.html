<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="PureBuilder Simply WP Importer" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <meta name="author" content="Masaki Haruka" />
    <meta name="date" content="2015-12-19T00:00:00+09:00" />
    <meta name="dcterms.date" content="2015-12-19T00:00:00+09:00" />
    <title>自前PostfixサーバーとGMail - Chienomi</title>
    <style type="text/css">article {
max-width: 1080px;
margin: auto;
}</style>
  </head>
  <body>

    <section id="ContentContainer">
      <header id="MainHeader"><a href="/"><h1>Chienomi</h1></a></header>
      <section id="ArticleBox">
        <header id="ArticleTitle"><h1>自前PostfixサーバーとGMail</h1></header>
        <article id="MainArticle">


<p>自前のメールサーバーからGMailにメールを送ると</p>

<blockquote>
  <p>&lt;*.com&gt;: host
    gmail-smtp-in.l.google.com[2404:6800:4008:c02::1b] said: 550-5.7.1
    [2001:2e8:649:0:2:1:0:11      12] Our system has detected that this
    550-5.7.1 message is likely unsolicited mail. To reduce the amount of spam
    sent 550-5.7.1 to Gmail, this message has been blocked. Please visit 550
    5.7.1  https://support.google.com/mail/answer/188131 for more information.
    kt7si2092671igb.13 - gsmtp (in reply to end of DATA command)</p>
</blockquote>

<p>のように言われてしまう。</p>

<p>迷惑メールとしてブロックされてしまうのだ。されない場合もあるが、その原因がよくわからなかった。</p>

<p>色々と調べた結果、どうもDNSレコード内にSPFの記述が欠如していると配送されない、ということのようだ。</p>

<p>SPFは、メール配送においてそのドメインから贈られたメールとして受け取るべきサーバーのアドレスを示すものだ。そのアドレス以外からは当該ドメインのメールを受け取らない、というポリシーにすることによって、なりすましを防ぐ、らしい。</p>

<p>SMTPがちゃんとリレーしてくれない昨今、ローカルSMTPが使えなくなる原因ともなり、ひたすらやりにくい気がするが、まぁなりすましメールを防ごうというわけだ。</p>

<p>SPFはTXTレコードとして存在し、うちの場合</p>

<pre><code>v=spf1 +ip4:27.120.84.145 +ip6:2001:2e8:649:0:2:1:0:11 ~all
</code></pre>

<p>となっている。これによって、<code>@reasonset.net</code>からのメールは、このアドレス以外のサーバーから配送された場合はなりすましメールとみなし、排除してよい、という情報を与えることとなる。
GmailはSPFを必須とするようだ。</p>

<p>SPFレコードを追加したが、それでもGMailに拒否される。
どうやら、AAAAレコードも必要なようだ。AAAAレコードを追加したところ、拒否されなくなった。
ただし、失敗を繰り返したアドレスに対してはいばらく送ることができなかった。</p>

<!-- PBSEARCH_RESULT -->
        </article>
    </section>
    <footer id="InfoFooter">
      <ul>
        <li>© Masaki Haruka 2003.</li>
        <li>Generated by <a href="https://gitlab.com/reasonset/pbsimply-wpimporter">PureBuilder Simply WP Importer</a></li>
      </ul>
    </footer>
  </body>
</html>
