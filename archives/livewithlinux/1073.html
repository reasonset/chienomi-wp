<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="PureBuilder Simply WP Importer" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <meta name="author" content="Masaki Haruka" />
    <meta name="date" content="2017-07-07T00:00:00+09:00" />
    <meta name="dcterms.date" content="2017-07-07T00:00:00+09:00" />
    <title>Blink/Mozillaブラウザの表示乱れと、BlinkブラウザのSEGVについて - Chienomi</title>
    <style type="text/css">article {
max-width: 1080px;
margin: auto;
}</style>
  </head>
  <body>

    <section id="ContentContainer">
      <header id="MainHeader"><a href="/"><h1>Chienomi</h1></a></header>
      <section id="ArticleBox">
        <header id="ArticleTitle"><h1>Blink/Mozillaブラウザの表示乱れと、BlinkブラウザのSEGVについて</h1></header>
        <article id="MainArticle">
<p>LinuxにおけるBlink系ブラウザ(Google Chrome, Chromium, Opera, Vivaldi)においてページクラッシュする(場合によっては全ページがクラッシュする)という問題に長く悩まされていた。 SEGVが発生しており、エラーメッセージとしては:</p>
<pre><code>../../third_party/tcmalloc/chromium/src/free_list.h:118] Memory corruption detected.</code></pre>
<p>というものだ。</p>
<ul>
<li>発生がランダムである(ページによって発生しやすさには偏りがある)</li>
<li>特定ユーザーでしか発生しない</li>
<li>新規ユーザーを作っても発生するが、2番目のユーザーだけは決して発生しない</li>
<li>以前にも同様の事象が発生したことがある</li>
<li>再インストールやブラウザのバージョンによっても解決しない</li>
<li>プロファイルやソフトウェアによらず発生する</li>
</ul>
<p>といった問題かが見られ、解決方法が見えず長く苦しむこととなった。</p>
<p>だが、ようやく解決が見られた。</p>
<p>この問題のほかに、ブラウザでのフォント表示の乱れという問題があった。ビックマップフォントと思わしき汚いフォントが表示されたり、フォントが破断しまともに読めないといった状態が発生していた。 これは拡大率を変更することで改善したりするが、別の箇所でまた発生したりもする。</p>
<p>これについて検証していると、フォント指定が次のようなものの場合に発生するということがわかった。</p>
<pre><code>font-family: Meiryo, メイリオ, ArialMT, &quot;Hiragino Kaku Gothic Pro&quot;, &quot;ヒラギノ角ゴ Pro W3&quot;, Osaka, Verdana, &quot;ＭＳ Ｐゴシック&quot;;</code></pre>
<p>これはねとらぼのものだ。autoblogは以下</p>
<pre><code>font-family: “ヒラギノ角ゴ Pro W3″,”Hiragino Kaku Gothic Pro”,”Osaka”,”メイリオ”,”Meiryo”,”ＭＳ Ｐゴシック”,”MS PGothic”,sans-serif !important;</code></pre>
<p>アスキーは以下</p>
<pre><code>font: 13px/1.231 &#39;Hiragino Kaku Gothic ProN&#39;,Meiryo,&quot;メイリオ&quot;,&#39;MS PGothic&#39;,sans-serif;</code></pre>
<p>これらのスタイルを削除すると正常に表示される。 このPCはMSフォントファミリーと、Osakaフォントのクローンが認識されている。そのため、ブラウザ設定によらずこのどちらかを使おうとするようなのだが、するとフォントが異常表示されるのだ。 これは、どちらか片方を削除しても解決しない。</p>
<p>フォント自体を削除しなくても、これらのフォントを置き換えれば解決する。</p>
<pre><code>&lt;match target=&quot;pattern&quot;&gt;
  &lt;test qual=&quot;any&quot; name=&quot;family&quot;&gt;
    &lt;string&gt;MS PGothic&lt;/string&gt;
  &lt;/test&gt;
  &lt;edit name=&quot;family&quot; mode=&quot;assign&quot; binding=&quot;same&quot;&gt;
    &lt;string&gt;Ume P Gothic S5&lt;/string&gt;
  &lt;/edit&gt;
&lt;/match&gt;
&lt;match target=&quot;pattern&quot;&gt;
  &lt;test qual=&quot;any&quot; name=&quot;family&quot;&gt;
    &lt;string&gt;ＭＳ Ｐゴシック&lt;/string&gt;
  &lt;/test&gt;
  &lt;edit name=&quot;family&quot; mode=&quot;assign&quot; binding=&quot;same&quot;&gt;
    &lt;string&gt;Ume P Gothic S5&lt;/string&gt;
  &lt;/edit&gt;
&lt;/match&gt;
&lt;match target=&quot;pattern&quot;&gt;
  &lt;test qual=&quot;any&quot; name=&quot;family&quot;&gt;
    &lt;string&gt;Osaka&lt;/string&gt;
  &lt;/test&gt;
  &lt;edit name=&quot;family&quot; mode=&quot;assign&quot; binding=&quot;same&quot;&gt;
    &lt;string&gt;Ume P Gothic S5&lt;/string&gt;
  &lt;/edit&gt;
&lt;/match&gt;</code></pre>
<p>単一の<code>test</code>内に<code>string</code>を複数置けなくなったけれど、もうちょっとスマートな書き方はできないのだろうか?</p>
<p>また、この問題に対処してから、ブラウザが落ちることはなくなった。 確証はないが、SEGV(Memory corruption)の原因がフォントにある、というのはちょっと想像がつかなかったし、しかも信頼できるMSフォントファミリーやOsakaフォントというのは全く想像が及ばなかった。</p>
<p>なんでそうなるのか、ということはわからないが、とにかく原因がわかってほっとしている。 わうやくまともなブラウジングができるようになって本当によかった。</p>

<!-- PBSEARCH_RESULT -->
        </article>
    </section>
    <footer id="InfoFooter">
      <ul>
        <li>© Masaki Haruka 2003.</li>
        <li>Generated by <a href="https://gitlab.com/reasonset/pbsimply-wpimporter">PureBuilder Simply WP Importer</a></li>
      </ul>
    </footer>
  </body>
</html>
