<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="PureBuilder Simply WP Importer" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <meta name="author" content="Masaki Haruka" />
    <meta name="date" content="2014-08-17T00:00:00+09:00" />
    <meta name="dcterms.date" content="2014-08-17T00:00:00+09:00" />
    <title>Linuxトラブルとの格闘 - Chienomi</title>
    <style type="text/css">article {
max-width: 1080px;
margin: auto;
}</style>
  </head>
  <body>

    <section id="ContentContainer">
      <header id="MainHeader"><a href="/"><h1>Chienomi</h1></a></header>
      <section id="ArticleBox">
        <header id="ArticleTitle"><h1>Linuxトラブルとの格闘</h1></header>
        <article id="MainArticle">
<p>15日、Manjaroが起動しなくなった。systemdが途中で沈黙してしまう、という症状だ。</p>
<p>systemdが、となるとそう簡単ではないため、とりあえずMageiaに戻ったのだが（もちろん、home directoryにおける様々な問題が生じた）、17日、そのMageiaに致命的な現象が生じた。</p>
<p>極めて重くなったため、topしてみると、nepomukfileindexなるプロセスが非常に激しく動いている。これはなんだ？</p>
<p>とりあえず再起動してみると、fork bombが発生した（konsoleが27 windows開いた）。nepomukのせいか!?</p>
<p>ファイルアクセスが激しいということはデータを盗み出す類のプロセスである可能性が高いと判断し、直ちにイーサネットケーブルを抜いて、別システムのインストールを行うことにした（今インシデントを扱える状況ではない）。</p>
<p>Manjaroを潰してSSDにMageiaをインストールすることにしたのだが、Btrfsが扱えない、LUKSをかけるとパスワードが入力できないなどのトラブルで何度も再インストールを余儀なくされた。</p>
<p>なお、Manjaroの再インストールもこの過程で何度もトライしているのだが、pacman-key --populateに失敗するためどうしようもなかった。どうも<a href="https://forum.manjaro.org/index.php?topic=7228.0" alt="Forumにあるこのケース">Forumにあるこのケース</a>と同様のようだが、相当苦戦しているで容易ならざることか。このフォーラムでも解決していないようだ。</p>
<p>特に注意してほしいのが、インストーラでキーボードレイアウトにJPを選ぶとJPキーボードでインストールされる。ところが、ログインするとその状態ではinput methodが何も設定されておらず、iBusはUSキーボードのレイアウトで入力させる。そのため、記号を含むパスワードを設定しているとキーボードレイアウトの違いからlogin incorrectとなる。</p>
<p>なお、KDMではJPキーボードでインストールしているのであれば自動的にJPキーボードの配列で入力することになり、ログインは通常通りできる。このことでだいぶハマった。</p>
<p>しかしセットアップしていくと、再びnepomukが顔を出す。何者なのだこいつ。</p>
<p>そこでrpm -qfしてみると、<tt class="pure_idname">nepomuk</tt>, <tt class="pure_idname">nepomuk-core</tt>, <tt class="pure_idname">kde-core</tt>に含まれていることが分かった。調べてみると、まっとうなプロジェクトで、それを積極的に利用している例がKDEだという。</p>
<p>ではあのfork bombとは別ものだったのか。あの妙な挙動は何だったのか。</p>
<p>分からないのだが、とりあえずは安心していいのだろうか。もちろん、virus checkもすませてあり、問題はほぼなかった。少なくとも懸念していた問題はみつからなかった。漏洩調査が必要だが、これはかなり難しい。また、汚染調査の追跡は、これから行うことになる。これもしばらくかかるだろう。パスワード変更作業などが迫っている。</p>
<p>ついでなので、インストール時点で/varを別に切りLVM上に置く、SSDにインストールするなどの懸案を片付けた。また、これまではhome directory（/homeとは別に、/home/user）にマウントしていたのだが、dor filesに非互換が生じることがあるため、この解決のために/home/user/shareにマウントするようにした。共有すべきdot filesをsymlinkにすることでdor filesなどの共有問題を解決し、基本的にはデータ共有とすることで問題及び影響を生じにくくした。</p>
<p>share下にあるディレクトリの設定上の問題(~/binなどでもある）が生じるため、従来通り~/localのpathを維持するため、~/localは../share/localのsymlinkとした。</p>
<p>今回の作業でよくわからない変化があった。</p>
<p>まず、gtk-query-updateをしてFirefoxで正常に日本語入力が可能になった。これまでなぜできないのか分からず様々な方策を試しているような状態だったのにだ。一方、meditはIMEは機能するが入力できない状態、つまり変換も確定もできない状態となっている。</p>

<!-- PBSEARCH_RESULT -->
        </article>
    </section>
    <footer id="InfoFooter">
      <ul>
        <li>© Masaki Haruka 2003.</li>
        <li>Generated by <a href="https://gitlab.com/reasonset/pbsimply-wpimporter">PureBuilder Simply WP Importer</a></li>
      </ul>
    </footer>
  </body>
</html>
