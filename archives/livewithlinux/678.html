<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="PureBuilder Simply WP Importer" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <meta name="author" content="Masaki Haruka" />
    <meta name="date" content="2015-07-15T00:00:00+09:00" />
    <meta name="dcterms.date" content="2015-07-15T00:00:00+09:00" />
    <title>Manjaro Linux 0.8.13 setup (4) - Chienomi</title>
    <style type="text/css">article {
max-width: 1080px;
margin: auto;
}</style>
  </head>
  <body>

    <section id="ContentContainer">
      <header id="MainHeader"><a href="/"><h1>Chienomi</h1></a></header>
      <section id="ArticleBox">
        <header id="ArticleTitle"><h1>Manjaro Linux 0.8.13 setup (4)</h1></header>
        <article id="MainArticle">
<h3 id="インストールパッケージ">インストールパッケージ</h3>
<ul>
<li>tegaki-models-zinnia-japanese</li>
<li>tegaki-recognize</li>
<li>tegaki-models-wagomu-japanese</li>
<li>tegaki-tools</li>
<li>tegaki-train</li>
<li>libsidplayfp</li>
<li>vice</li>
<li>man-pages-ja</li>
<li>ngrep</li>
<li>qlivestreamer-git</li>
<li>python-librtmp</li>
<li>nkf</li>
</ul>
<p>tegaki系パッケージは、Mozcの手書き機能のため。 ただし、 ウィンドウを黒にしているためか、書いたところがまったく見えない。</p>
<p>man-pages-jaは日本語manpageのためのパッケージ。</p>
<p>ngrepはHTTP解析のために入れた。</p>
<p>qlivestreamerについてはあまり語らない。 Ustream関連で最も良い選択肢だと思われた。MPlayerの<code>--dump-stream</code>という方法もあるが、素直にCLIで。</p>
<p>なお、python-librtmpがないとモバイル用しか視聴できない模様。</p>
<p>nkfは入れ忘れ。 MailDeliver2が要求しなくなったので気づかなかった。</p>
<p>nkfをいれたのはberryjackのため。結構単純だが、Linuxで確実に機能するTwitterの画像に関するツールだ。 高速で、非常に良い。</p>
<h3 id="btrfsの破損">Btrfsの破損</h3>
<p>システムが急にフリーズをくりかえし、ガクガクしはじめたので再起動したところ、 ユーザーデータ用のファイルシステム(btrfs)がマウントできなくなった。</p>
<p>また、起動時がなぜかPlymothに以降するまでが遅い。</p>
<p>考えられる可能性としては</p>
<ul>
<li>システムディスク</li>
<li>システムファイルシステム</li>
<li>データディスク(btrfsを構成する4台のいずれか)</li>
<li>dm-cryptデバイス</li>
<li>btrfs</li>
</ul>
<p>のいずれか。</p>
<p>問題を切り分ける必要があったため、まずは確実に再現することを確認し、データディスクを切り離し、単一ディスクで起動した。 結果、正常に起動した。</p>
<p>なお、こうした理由も含めて、データディスクはsystemdユニットではマウントしていない。</p>
<p>その上で、LiveDVDでブートし、dm-crypt plainによる復号化とデバイスへのアクセスが可能であることを確認。 また、ファイルシステムに対する操作を行おうとするとフリーズすることも確認した。 なお、フリーズするとデバイスビジーになるため終了もできない。</p>
<p>通常のシステムを起動して、復号化までで留め、</p>
<pre><code>btrfsck /dev/mapper/CRYPTDEVICE1</code></pre>
<p>ずらずらーっとエラーが出る。updateどうちゃらとか。 だが、最終的にはエラーは0とリポートされる。</p>
<p>続いて</p>
<pre><code>btrfsck --repair /dev/mapper/CRYPTDEVICE1</code></pre>
<p>しかし、エラーが発見されなかった以上修正もされない。 だが、先ほどずらずらっと出たエラーは出なくなり、また正常に動作するようにもなった。 scrubしても0errorsだった。</p>
<p>btrfsは障害が発生した時に、障害が発生したことを通知できるようにできないものだろうか。 フリーズしたり機能しないなど、調査が大変だ。</p>
<h3 id="先日のエントリでのメール処理">先日のエントリでのメール処理</h3>
<p>割と単純</p>
<p>メールアドレスのマスク</p>
<pre><code>for i in tmp/ab-0*
do
sed -e -i &#39;s/\w[a-zA-Z0-9_-]*@/*@/g&#39; &quot;$i&quot;
done</code></pre>
<p>PGPシグネチャの除去(メールアドレス対策)</p>
<pre><code>for i in tmp/ab-0*
do
sed -e &#39;/-----BEGIN PGP SIGNA/,/-----END/d&#39; &quot;$i&quot;
done</code></pre>
<p>Markdownのcodeblock化</p>
<pre><code>for i in tmp/ab-0*
do
sed -i -e &#39;s/.*/\t&amp;/&#39; &quot;$i&quot;
done</code></pre>
<p>ちなみに、SylphhedはPGP-Inlineをメールに対して選択できないので</p>
<pre><code>gpg --clearsign --local-user ADDRESS</code></pre>
<p>して署名。</p>
<h3 id="spamassassin">SpamAssassin</h3>
<p>umask000で実行するようにしないとダメらしい。</p>
<p>ディレクトリやファイルはrootで作るが、アクセスは一般ユーザーで行うため。</p>
<h3 id="mikutterの効果音">Mikutterの効果音</h3>
<p>ALSAであれPulseAudioであれ、内部ではaplayを使っているため、 使用するファイルはPCM(.wav)でなければ盛大なノイズになる。</p>
<h3 id="第一カラムの数字を数値として合計する">第一カラムの数字を数値として合計する</h3>
<p>簡易帳簿の計算のために用いた</p>
<pre><code>puts ARGF.each.inject(0) {|sum, x| sum + (x.split(/\s+/).first.to_i) }</code></pre>
<h3 id="ffmpegで切り出し">ffmpegで切り出し</h3>
<p>例えば</p>
<pre><code>ffmpeg -ss 420 -i source.mov -vcodec libx264 -t 360 -strict -2 -crf 32 dest.mp4</code></pre>
<p>のように行う。</p>
<p><code>-ss</code>オプションで開始秒数、<code>-t</code>オプションで切り出す長さの秒数を指定する。 <code>-i</code>オプションよりも手前に<code>-ss</code>を置くことで所要時間を大幅に短縮できるが、正しく切り出せない場合がある。しかし、copyではなく、明示して再エンコードすることで解決するという。</p>
<h3 id="xがおかしい">Xがおかしい</h3>
<p>Manjaro Stable 2015-07-14を適用したところ、ログイン時にXFceが起動するようになった。 しかもそれだけではなく、「XFceが起動し、ログアウトすると選択したデスクトップ環境が起動する」というわけのわからない状態になった。</p>
<p>lightdmやX関連スクリプトを見たのだが、原因になるようなものは見当たらない。</p>
<p>結局、どうもユーザーコンフィグ関連がおかしくなっていたようで、</p>
<pre><code>rm ~/.x* ~/.X*</code></pre>
<p>で直った。</p>

<!-- PBSEARCH_RESULT -->
        </article>
    </section>
    <footer id="InfoFooter">
      <ul>
        <li>© Masaki Haruka 2003.</li>
        <li>Generated by <a href="https://gitlab.com/reasonset/pbsimply-wpimporter">PureBuilder Simply WP Importer</a></li>
      </ul>
    </footer>
  </body>
</html>
