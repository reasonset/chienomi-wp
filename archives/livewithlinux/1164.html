<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="PureBuilder Simply WP Importer" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <meta name="author" content="Masaki Haruka" />
    <meta name="date" content="2017-11-26T00:00:00+09:00" />
    <meta name="dcterms.date" content="2017-11-26T00:00:00+09:00" />
    <title>Pandoc + TexLive (LuaTex)によるPDF生成と和文フォント - Chienomi</title>
    <style type="text/css">article {
max-width: 1080px;
margin: auto;
}</style>
  </head>
  <body>

    <section id="ContentContainer">
      <header id="MainHeader"><a href="/"><h1>Chienomi</h1></a></header>
      <section id="ArticleBox">
        <header id="ArticleTitle"><h1>Pandoc + TexLive (LuaTex)によるPDF生成と和文フォント</h1></header>
        <article id="MainArticle">
<p>Pandocは非常に便利なツールだが、オプションがなかなか複雑で、特にPDFにする場合などは長くて毎回打つのはしんどい。 このことは初心者にとって使いにくい理由のひとつになっていると思い、<a href="https://github.com/reasonset/gendoc-pandoc-jp">簡単に扱うためのZshスクリプトを書いた</a>。</p>
<p>だが、この際に思わぬことに気づいた。</p>
<p>LuaTeX(TexLive)経由でPDF化する際に、ドキュメントクラスが<code>article</code>や<code>report</code>なら<code>-V mainfont</code>が効くのだが、<code>ltjarticle</code>や<code>ltjsarticle</code>では効かない。 正確には、欧文にしか効かない。</p>
<p>追いかけると、LuaTeXは<code>mainfont</code>は欧文フォントの指定であり、和文フォントは独立して<code>mainjfont</code>を用いること、とある。 しかし、<code>-V mainjfont=...</code>は効かない。</p>
<p>検索すると<code>mainfont</code>を指定すれば良い、というページばかりヒットするのだが。 諸君は本当に試したのか。見聞きしたままコピペしてないか。</p>
<p>というわけで、Pandoc 日本ユーザー会の<span class="citation" data-cites="sky_y">[藤原 惟さん(すかいゆきさん, @sky_y)]</span>(https://twitter.com/sky_y)にご報告させていただいた。</p>
<p>すると、一時間ほどでご回答いただけた。</p>
<blockquote class="twitter-tweet" data-lang="ja">
<p lang="ja" dir="ltr">
CJKmainfont(和文用)はmainfont(欧文用)と併用可能です。<br>例: -V mainfont=“Courier New” -V CJKmainfont=“meiryo” <a href="https://t.co/RER7GMu48A">pic.twitter.com/RER7GMu48A</a>
</p>&mdash; 藤原 惟 (@sky_y) <a href="https://twitter.com/sky_y/status/934370831429378049?ref_src=twsrc%5Etfw">
2017年11月25日</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p><code>-V CJKmainfont=...</code>とすると和文フォントが指定できる、と。</p>
<p><code>-V mainfont=...</code>で欧文フォント、<code>-V CJKmainfont=...</code>で和文フォントの指定。 早速スクリプトにも反映した。</p>
<p>今回の解決はすべて藤原惟さんのおかげである。 改めて、この場を借りて感謝申し上げたい。</p>
<p>さて、Pandocは非常に便利なツールなのだが、多様なフォーマットに変換する都合からか、微妙なバグが割と多い。 そのバグが変換先エンジンの問題なのか、Pandocの問題なのか切り分けにくいので毎度なかなか辛い。</p>
<p>現時点では<code>--pdf-engine=lualatex</code>環境下において</p>
<ul>
<li>テーブルが右に突き抜けてしまうことがある (発生するテーブルであれば、書き方を変えても駄目)</li>
<li>ページを下に突き抜けてしまうことがある (脚注やページ番号にはかぶってページの外に出る。 表と画像を併用すると発生しやすい)</li>
</ul>
<p>ということを把握している。 どちらもPandocよりはTexLiveが原因のような気がするが、発生原因が特定できず、現在のところ謎バグである。</p>
<p>また、</p>
<ul>
<li>インラインコードの<code>--</code>がTeXのハイフンに変換される</li>
<li>コード中の<code>&quot;</code>がTeXの引用符に変換される</li>
</ul>
<p>という問題もあるのだけれど、これも<a href="https://github.com/reasonset/gendoc-pandoc-jp">冒頭で紹介したスクリプト</a>においては発生せず、</p>
<pre class="sourceCode bash" id="cb1"><code class="sourceCode bash"><div class="sourceLine" id="cb1-1" data-line-number="1"><span class="ex">pandoc</span> -s --filter pandoc-crossref -f markdown -V geometry=a4paper -V geometry:margin=1in -V mainfont=<span class="st">&quot;Source Han Serif JP&quot;</span> -V monofont=<span class="st">&quot;VL Gothic&quot;</span> -V documentclass=ltjarticle --pdf-engine=lualatex --toc <span class="st">&quot;</span><span class="va">$1</span><span class="st">&quot;</span> -o <span class="st">&quot;</span><span class="va">${1:r}</span><span class="st">.pdf&quot;</span></div></code></pre>
<p>とすると発生する。CJKフォントを指定しても発生する。ドキュメントクラスを<code>ltjsarticle</code>にしても発生する。 けれど、スクリプトが実行しているデフォルトの内容としては</p>
<pre class="sourceCode bash" id="cb2"><code class="sourceCode bash"><div class="sourceLine" id="cb2-1" data-line-number="1"><span class="ex">pandoc</span> -s -f markdown -V geometry=a4paper -V documentclass=ltjsarticle --pdf-engine=lualatex --toc -o test.pdf test.md</div></code></pre>
<p>なのだけど発生しない。元のコマンドでフォント指定をやめると発生しなくなる。 どうも試していくと<code>monofont</code>を指定するとフォントがなんであれ駄目っぽい。</p>

<!-- PBSEARCH_RESULT -->
        </article>
    </section>
    <footer id="InfoFooter">
      <ul>
        <li>© Masaki Haruka 2003.</li>
        <li>Generated by <a href="https://gitlab.com/reasonset/pbsimply-wpimporter">PureBuilder Simply WP Importer</a></li>
      </ul>
    </footer>
  </body>
</html>
