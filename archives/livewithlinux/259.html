<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="PureBuilder Simply WP Importer" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <meta name="author" content="Masaki Haruka" />
    <meta name="date" content="2014-08-30T00:00:00+09:00" />
    <meta name="dcterms.date" content="2014-08-30T00:00:00+09:00" />
    <title>ルーターをCentOS7に - Chienomi</title>
    <style type="text/css">article {
max-width: 1080px;
margin: auto;
}</style>
  </head>
  <body>

    <section id="ContentContainer">
      <header id="MainHeader"><a href="/"><h1>Chienomi</h1></a></header>
      <section id="ArticleBox">
        <header id="ArticleTitle"><h1>ルーターをCentOS7に</h1></header>
        <article id="MainArticle">
<p>CentOS6はUSB NICを認識できなかったため、慣れないUbuntuを使ってきたが、ついにCentOS 7への移行を実現した。</p><p>刷新されたAnacondaインストーラを使う。何もいじらずにインストールできるようになっているが、その一方でインストールしながらユーザーが作成できるなど効率的なデザインに変化している。シンプルながら機能性が失われておらず、なかなか驚きがある。</p><p>インストールが完了すると例によってmei_meが騒ぐ。とりあえずrootでログインし</p><pure:sampblock># rmmod mei_me</pure:sampblock><p>さらに二度と起動しないように、/etc/modprobe.d/blacklist.conf に</p><pure:sampblock>blacklist mei
blacklist mei_me"
</pure:sampblock><p>とどめに、/etc/modprobe.d/modprobe.conf.local</p><pure:sampblock>install mei /bin/true
install mei_me /bin/true
</pure:sampblock><p>NICの設定はAnacondaから行える。そのためいきなりネットワークに接続できた。</p><p>ネットワークの設定はnmtuiまたはnmcliで行う。nmtuiは対話的に利用できる。これを用いて設定する。もちろん、USB NICも正しく認識されている。</p><p>ifconfigがないため、net-toolsをインストールしておくほうが良い。また、digコマンドもないため、dns-toolsをインストールしておく。このほか、zshとvimとdnsmasqをとりあえずインストールした。</p><p>IP forwardingが無効となっているため、これを恒久的に有効にする方法を探したが、良い記述がない。systemdに移行したための問題だ。そこでやや乱暴だが、/etc/sysctl.d/99-sysctl.confに</p><pure:sampblock>net.ipv4.ip_forward = 1
</pure:sampblock><p>と書いておく。これでリブートしておおよそうまく動くのだが、DNSをフォワードしてくれない。ファイアウォールに起因するが、CentOS7はfirewalldを使用しており、設定方法が分からない。とりあえずfirewalldを無効化すれば動く。</p><p>だが、もちろんそれは困るので、とりあえずsubID 0x10のネットワークのコネクションは全部通過するようにする。通らないのはDNSなので、sshログインで設定可能だ。</p><p>firewalldは動いていなければいけない。そして、0x10インターフェイスをtrustedにする。</p><pure:sampblock># firewall-cmd --zone=trusted --change-interface=enp0s25</pure:sampblock><p>さらに恒久化するため、/etc/sysconfig/network-scripts/ifcfg-enp0s25にZONE=trustedを追記する。これで0x10(enp0s25)から入ってくるトラフィックは全て通過するようになった。</p><p>dnsmasqを設定すると、Ubuntuのように訳の分からないことならず、正しくDHCP, DNSともに機能する。</p><p>全体的な印象としては、systemd, firewalldという新機構が案の定手強い状況だ。Fedoraと違いiptablesと共存しているわけではないため、firewalldの設定は必ず習得しなければいけないという厳しいものだ。GUI込みならばそれほど難しくないのかもしれないが。</p><p>困ったことに検索してみても、firewall-configを紹介しているだけで、firewalldのコマンドラインにおける設定方法は全く紹介されていないのだ。</p>
<!-- PBSEARCH_RESULT -->
        </article>
    </section>
    <footer id="InfoFooter">
      <ul>
        <li>© Masaki Haruka 2003.</li>
        <li>Generated by <a href="https://gitlab.com/reasonset/pbsimply-wpimporter">PureBuilder Simply WP Importer</a></li>
      </ul>
    </footer>
  </body>
</html>
