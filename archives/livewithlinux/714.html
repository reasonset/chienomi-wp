<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="PureBuilder Simply WP Importer" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <meta name="author" content="Masaki Haruka" />
    <meta name="date" content="2015-08-31T00:00:00+09:00" />
    <meta name="dcterms.date" content="2015-08-31T00:00:00+09:00" />
    <title>Manjaro 0.8.13.1 LXQt を LVM + LUKS + GPT + UEFIインストール - Chienomi</title>
    <style type="text/css">article {
max-width: 1080px;
margin: auto;
}</style>
  </head>
  <body>

    <section id="ContentContainer">
      <header id="MainHeader"><a href="/"><h1>Chienomi</h1></a></header>
      <section id="ArticleBox">
        <header id="ArticleTitle"><h1>Manjaro 0.8.13.1 LXQt を LVM + LUKS + GPT + UEFIインストール</h1></header>
        <article id="MainArticle">
<p>3回失敗したので、メモを兼ねて。</p>
<p>情報は</p>
<ul>
<li><a href="https://wiki.manjaro.org/index.php/Installation_to_SSD_(quick_guide)">Installation to SSD (quick guide)</a></li>
<li><a href="https://wiki.manjaro.org/index.php?title=UEFI_-_Install_Guide">UEFI - Install Guide</a></li>
</ul>
<p>の2箇所にあるため、これを組み合わせる必要がある。 また、情報の欠如もあるので補足する。</p>
<p>まずはターミナルを起動</p>
<pre><code>$ su -
  manjaro #Password
# gdisk /dev/sda</code></pre>
<p><code>/dev/sda</code>がインストール対象ディスクであるとする。 以下オペレーションは</p>
<ul>
<li>o #新しいGPTレベルを作成</li>
<li>Y #確認</li>
<li>n #新規パーティション (BIOS GRUBのためのもの。なくてもいい？)</li>
<li>(enter) #次のパーティション</li>
<li>(enter) #フリー部分の先頭</li>
<li>+1M # 1MiBのパーティション</li>
<li>n #新規パーティション (ESP)</li>
<li>(enter) #次のパーティション</li>
<li>(enter) #フリー部分の先頭</li>
<li>+256M # 256MiBのパーティション</li>
<li>n #新規パーティション (/boot)</li>
<li>(enter) #次のパーティション</li>
<li>(enter) #フリー部分の先頭</li>
<li>+512M # 512MiBのパーティション</li>
<li>n #新規パーティション (LVM)</li>
<li>(enter) #次のパーティション</li>
<li>(enter) #フリー部分の先頭</li>
<li>(enter) # entire disk</li>
<li>w #書き込み</li>
<li>Y #確認</li>
</ul>
<p>LVM on LUKSの構築</p>
<pre><code># cryptsetup luksFormat -y --cipher aes-xts-plain --key-size 512 /dev/sda4
# cryptsetup luksOpen /dev/sda4 sda4_crypt
# pvcreate --dataalignment 1024k /dev/mapper/sda4_crypt
# vgcreate cryptVG /dev/mapper/sda4_crypt
# lvcreate -n root -L 20G cryptVG
# lvcreate -n swap -L 16G cryptVG
# lvcreate -n home -l 100%FREE cryptVG</code></pre>
<p>インストーラはSwapを求めるし、Swap用のボリュームも確保した。</p>
<p>で、</p>
<pre><code># setup</code></pre>
<ul>
<li><ol style="list-style-type: decimal">
<li>Set date and time</li>
</ol></li>
<li><ol start="2" style="list-style-type: decimal">
<li>Partition Hard Drives</li>
</ol>
<ul>
<li>swap - /dev/mapper/cryptVG-swap</li>
<li>/ - /dev/mapper/cryptVG-root</li>
<li>/home - /dev/mapper/cryptVG-home</li>
<li>/boot - /dev/sda3 (EXT3)</li>
<li>/boot/efi - /dev/sda2 (VFAT)</li>
</ul></li>
<li><ol start="3" style="list-style-type: decimal">
<li>Install System</li>
</ol></li>
<li><ol start="4" style="list-style-type: decimal">
<li>Configure System - mkinitcpio.confについて<code>HOOK</code>行に<code>encrypt lbm2</code>を<code>sata filesystem</code>よりも先に記述する。そのままこの画面に留まる</li>
</ol></li>
<li>タブを開く</li>
<li><code>/install/etc/default/grub</code>に<code>GRUB_CMDLINE_LINUX_DEFAULT=&quot;cryptdevice=/dev/sda4:cryptVG&quot;</code>と記述する</li>
<li>installerの4から離れる</li>
<li><ol start="5" style="list-style-type: decimal">
<li>Install bootloader</li>
</ol>
<ul>
<li>UEFI_x86_64</li>
<li>GRUB_UEFI_x86_64</li>
<li>フォーマット</li>
<li>efivarsが読まれてないよと言われる場合も無視して良い</li>
<li>コピーするかと聞かれた場合はYES</li>
</ul></li>
<li><ol start="6" style="list-style-type: decimal">
<li>Quit</li>
</ol></li>
<li>再起動</li>
</ul>
<p>この作業を繰り返したことで、だいたいLUKSパーティションの起動やUEFIについて仕組みが理解できてよかった。</p>
<p>ただし、実際に動くかどうかを確認できていない。 なぜならば、ハードウェア結局UEFIをサポートしていなかったからだ。どうりで失敗するわけだ。</p>

<!-- PBSEARCH_RESULT -->
        </article>
    </section>
    <footer id="InfoFooter">
      <ul>
        <li>© Masaki Haruka 2003.</li>
        <li>Generated by <a href="https://gitlab.com/reasonset/pbsimply-wpimporter">PureBuilder Simply WP Importer</a></li>
      </ul>
    </footer>
  </body>
</html>
