<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="PureBuilder Simply WP Importer" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <meta name="author" content="Masaki Haruka" />
    <meta name="date" content="2018-06-06T00:00:00+09:00" />
    <meta name="dcterms.date" content="2018-06-06T00:00:00+09:00" />
    <title>Linux: 特定のアドレスに到達しないことを明示する (route/ipコマンド) - Chienomi</title>
    <style type="text/css">article {
max-width: 1080px;
margin: auto;
}</style>
  </head>
  <body>

    <section id="ContentContainer">
      <header id="MainHeader"><a href="/"><h1>Chienomi</h1></a></header>
      <section id="ArticleBox">
        <header id="ArticleTitle"><h1>Linux: 特定のアドレスに到達しないことを明示する (route/ipコマンド)</h1></header>
        <article id="MainArticle">
<p>open-iscsiを用いたiSCSIイニシエータの場合、iSCSIターゲットが複数のIPアドレスを持っているとMultipathによってその全てのアドレスで接続しようとする。</p>
<p>だが、例えば192.168.1.0/24に属するコンピュータで、192.168.1.0/24, 192.168.2.0/24の両方に属しているNASを使おうとすると、192.168.2.0/24に対する経路がなければタイムアウトするまでひどく待たされることになる。 デフォルトゲートウェイ経由で192.168.2.0/24に対するパケットを投げ続けるためだ。</p>
<p>そこで、このコンピュータは192.168.2.0/24には通じていないことを明示して、即座に失敗させたい。</p>
<p>これはネットワークマネージャの設定では行うことができない。 コマンドで行う必要がある。</p>
<p>routeコマンドに関してはManpageに書いてあるのでわかりやすい。</p>
<pre><code># route add 192.168.2.0 netmask 255.255.255.0 reject</code></pre>
<p>だが、Arch Linux系列のディストリビューションで標準採用されるipコマンド (iproute2) のほうは<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>Manpageがものすごく読みにくい上に日本語訳もされていないのでちょっと大変だ。 ipコマンドの場合は次のようにする。</p>
<pre><code># ip route add prohibit 192.168.2.0/24</code></pre>
<p>これにより192.168.2.0/24に対する接続はそもそも禁止されることになる。</p>
<pre><code>% ping 192.168.2.64
Do you want to ping broadcast? Then -b. If not, check your local firewall rules.
% telnet 192.168.2.64
Trying 192.168.2.64...
telnet: Unable to connect to remote host: 許可がありません</code></pre>
<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p>そもそもrouteやifconfigなどを使わず、iproute2(ip)を使うということをどれくらいの人が知っているのだろう? arp, ifconfig, iwconfig, nameif, netstat, route を兼ねる仕組みになっており、Manjaro Linuxではこれらのコマンドは標準では入っていない。 digやnslookupも含まれておらず、getentを使用する。<a href="#fnref1" class="footnote-back">&#x21a9;</a></p></li>
</ol>
</section>

<!-- PBSEARCH_RESULT -->
        </article>
    </section>
    <footer id="InfoFooter">
      <ul>
        <li>© Masaki Haruka 2003.</li>
        <li>Generated by <a href="https://gitlab.com/reasonset/pbsimply-wpimporter">PureBuilder Simply WP Importer</a></li>
      </ul>
    </footer>
  </body>
</html>
