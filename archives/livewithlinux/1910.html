<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="PureBuilder Simply WP Importer" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <meta name="author" content="Masaki Haruka" />
    <meta name="date" content="2019-01-03T00:00:00+09:00" />
    <meta name="dcterms.date" content="2019-01-03T00:00:00+09:00" />
    <title>systemd-nspawnでManjaro LinuxからArch Linuxする - Chienomi</title>
    <style type="text/css">article {
max-width: 1080px;
margin: auto;
}</style>
  </head>
  <body>

    <section id="ContentContainer">
      <header id="MainHeader"><a href="/"><h1>Chienomi</h1></a></header>
      <section id="ArticleBox">
        <header id="ArticleTitle"><h1>systemd-nspawnでManjaro LinuxからArch Linuxする</h1></header>
        <article id="MainArticle">
<h2 id="systemd-nspawn">systemd nspawn</h2>
<p>なんかSystemdを毛嫌いする人が多いのだけど、結構使いやすくて便利な機能が多いので、私は好きだ。Xサーバーみたいだと思う。</p>
<p>systemd-nspawnはcrgoupsを利用したLinuxコンテナである。 LXCよりもずっとシンプルな実装で、かつ簡単に使うことができる。 全然知られていないけど。</p>
<h2 id="とりあえずarchする">とりあえずArchする</h2>
<p>Manjaroにもarch-install-scriptsがあるためpacstrapできたりする。 なので、初回インストール前には</p>
<pre><code># pacman -S arch-install-scripts</code></pre>
<p>とやっておく。</p>
<p>そしたらコンテナを作る。 こちらは新規コンテナを作るときにやる作業。</p>
<pre><code># pacstrap -i -c ~/Container base base-devel</code></pre>
<p>Arch Linuxをインストールしたことのある人ならわかると思うのだけど、 最低限<code>base</code>がないと機能しない。そして、AURを利用する場合は<code>base-devel</code>も含んでおかないといけない。</p>
<p>あとはログインする。 これは、起動時に実行するもの。</p>
<pre><code># systemd-nspawn -b -D ~/Container</code></pre>
<p>これでコンテナを起動することができる。終了する場合、<strong>コンテナ上</strong>で電源を切る。 終了は少し時間がかかる。</p>
<pre><code># poweroff</code></pre>
<p>LXCと違って自動的にブリッジインターフェイスもセットアップされ、起動しただけでネットワークがちゃんと機能する状態になる。 LXCと比べても随分と話が早い。</p>
<p>ManjaroだとArchを構築するのは簡単だし、もちろんArchやAnterogosでも簡単だけど、そうでないディストリビューションがどうやってコンテナ上にOSをインストールするか、については各々調べて欲しい。 私はArchが使えれば満足なので、コンテナ上で他のディストリビューションを使おうとは思わないし、現状、Manjaro以外をホストにしようとも思わないからだ。</p>
<h2 id="おまけこの環境からpowerlevel9kするために">おまけ。この環境からPowerlevel9kするために</h2>
<p>ちょっとつまずいたのでおまけ。 標準ロケールが<code>en_US.utf8</code>になっているため、Powerlevel9kのPowerline記号が出ない。</p>
<p>そこで、<code>/etc/locale.gen</code>を編集して<code>ja_JP.UTF-8 UTF-8</code>をアンコメントし、</p>
<pre><code># locale-gen</code></pre>
<p>そして、<code>/etc/locale.conf</code>を編集して<code>LANG</code>を<code>ja_JP.UTF-8</code>にしてから</p>
<pre><code># localectl set-locale LANG=ja_JP.UTF-8</code></pre>
<p>これでちゃんとPowerlevel9kのアイコンが出るようになる。</p>

<!-- PBSEARCH_RESULT -->
        </article>
    </section>
    <footer id="InfoFooter">
      <ul>
        <li>© Masaki Haruka 2003.</li>
        <li>Generated by <a href="https://gitlab.com/reasonset/pbsimply-wpimporter">PureBuilder Simply WP Importer</a></li>
      </ul>
    </footer>
  </body>
</html>
