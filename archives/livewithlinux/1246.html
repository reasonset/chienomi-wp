<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="PureBuilder Simply WP Importer" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <meta name="author" content="Masaki Haruka" />
    <meta name="date" content="2018-04-22T00:00:00+09:00" />
    <meta name="dcterms.date" content="2018-04-22T00:00:00+09:00" />
    <title>Linuxでキーボードをつないだまま掃除したい - Chienomi</title>
    <style type="text/css">article {
max-width: 1080px;
margin: auto;
}</style>
  </head>
  <body>

    <section id="ContentContainer">
      <header id="MainHeader"><a href="/"><h1>Chienomi</h1></a></header>
      <section id="ArticleBox">
        <header id="ArticleTitle"><h1>Linuxでキーボードをつないだまま掃除したい</h1></header>
        <article id="MainArticle">
<p>キーボードが汚れているなぁ、と気づいたとき、あるいはキーボードがべたつくとき、キーボードを掃除したいけれど電源を切りたくないということはないだろうか。 特にデスクトップの後方につないでいる場合や、ラップトップの場合にはキーボードを外すのも面倒な話だ。 スリープにしてもキーボードに触ったら復帰してしまうし、なかなか厄介だ。</p>
<p>そこで一時的にキーボードをつないだまま無効にする方法を考えてみた。</p>
<p>キーボードを無効にする方法としてはXによるデバイス認識であれば<code>xinput</code>が利用できる。</p>
<p>次の方法で認識されているデバイスを確認する。</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="ex">xinput</span> --list</a></code></pre></div>
<p>あまり見やすくはない。</p>
<pre><code>⎡ Virtual core pointer                      id=2    [master pointer  (3)]
⎜   ↳ Virtual core XTEST pointer                id=4    [slave  pointer  (2)]
⎜   ↳ ELECOM ELECOM UltimateLaser Mouse         id=9    [slave  pointer  (2)]
⎣ Virtual core keyboard                     id=3    [master keyboard (2)]
    ↳ Virtual core XTEST keyboard               id=5    [slave  keyboard (3)]
    ↳ Power Button                              id=6    [slave  keyboard (3)]
    ↳ Power Button                              id=7    [slave  keyboard (3)]
    ↳ FCL USB Keyboard                          id=8    [slave  keyboard (3)]</code></pre>
<p>キーボード全体をオフにしてしまうと困るかもしれない。 なので、<code>Virtual core keyboard</code>をオフにすることは思いとどまったほうがいいだろう。</p>
<p><code>FCL USB Keyboard</code>(idは<code>8</code>)を無効にするには次のようにする。(手前側の8がID、後のほうは固定の値)</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="ex">xinput</span> set-int-prop 8 <span class="st">&quot;Device Enabled&quot;</span> 8 0</a></code></pre></div>
<p>有効に戻すにはこうだ。</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="ex">xinput</span> set-int-prop 8 <span class="st">&quot;Device Enabled&quot;</span> 8 1</a></code></pre></div>
<p>外付けキーボードが他に用意できるならいきなり無効にしても構わないが、そうできない場合は時間で復帰するようにしたほうがいいだろう。</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="ex">on_and_off_keyboard</span> {</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">    <span class="ex">xinput</span> set-int-prop <span class="st">&quot;</span><span class="va">$1</span><span class="st">&quot;</span> <span class="st">&quot;Device Enabled&quot;</span> 8 0</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">    <span class="fu">sleep</span> 30</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">    <span class="ex">xinput</span> set-int-prop <span class="st">&quot;</span><span class="va">$1</span><span class="st">&quot;</span> <span class="st">&quot;Device Enabled&quot;</span> 8 1</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">}</a></code></pre></div>
<p>安全のためアプレットから復帰できるようにするほうがいいだろう。 マウスで操作できるよう、Zenityを使ってon/offできるようにした。 また、off時にはタイマーをかけることもでき、タイマーをかけない場合は確認される。</p>
<p><a href="https://gist.github.com/reasonset/c142833d214a7d94578c6b6e374ae188">Gist</a>で公開している。 Zshスクリプトであり、実際にZshの機能を使用しているのでBashでは動かない。 Zenityはなかなかコマンド置換が難しく、<code>(f)</code>は欠かせない。</p>

<!-- PBSEARCH_RESULT -->
        </article>
    </section>
    <footer id="InfoFooter">
      <ul>
        <li>© Masaki Haruka 2003.</li>
        <li>Generated by <a href="https://gitlab.com/reasonset/pbsimply-wpimporter">PureBuilder Simply WP Importer</a></li>
      </ul>
    </footer>
  </body>
</html>
