<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="PureBuilder Simply WP Importer" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <meta name="author" content="Masaki Haruka" />
    <meta name="date" content="2015-04-06T00:00:00+09:00" />
    <meta name="dcterms.date" content="2015-04-06T00:00:00+09:00" />
    <title>PureDocのTOC機能 - Chienomi</title>
    <style type="text/css">article {
max-width: 1080px;
margin: auto;
}</style>
  </head>
  <body>

    <section id="ContentContainer">
      <header id="MainHeader"><a href="/"><h1>Chienomi</h1></a></header>
      <section id="ArticleBox">
        <header id="ArticleTitle"><h1>PureDocのTOC機能</h1></header>
        <article id="MainArticle">
<p>PureDocにTOC機能をつけた。</p>
<p>これまでPureDocで生成されたドキュメントにはドキュメント内リンクのためのID振りがなかった。</p>
<p>そのため、長文になると結構たどりにくい。 また、文書を参照してもらうのが難しかった。</p>
<p>そこで暫定的にHTMLに直接IDを書いたあと、更新に備えてその機能を急造した。</p>
<p>今回はかなり書き直した。 ヘッダー関連のメタメソッドを書き換えただけではない。 専用のクラスまで書き足した。</p>
<p><code>TOC</code>クラスは<code>Struct</code>だが、<code>TOCContainer</code>は<code>Array</code>のサブクラスとなっている。 これは、TOCを作るためにストックされたヘッダ情報を展開するためのメソッドをもたせるためだ。</p>
<p>だが、ネストした構造（例えばリストでネストさせる）のTOCを作るための展開用メソッドはなかなか作れない。</p>
<p>必ずしもh1から順にあるわけでもなく、例えば</p>
<p>h3-&gt;h4-&gt;h2ということもありうる。 ネストした状態でこれを処理するのはかなり難しい。徐々に深くなる前提にしてしまわない限りどうやって開き、どうやって閉じるかは難しい。</p>
<p>とりあえず単純にインデクシングのためのヒントと共にイテレータを回す構造としたが、 インデックスの1増減の問題が激しく大変だった。</p>
<p>既にReasonsetのサイトは適用されている。まだ整頓されていない状態だが、あまりにも使いやすかったため、実際に全体に取り入れてしまっている。 ただし、IDの付け方は将来的には変更されるだろう。現在のままではコンフリクトする可能性が高い。</p>
<p>PureDocの変更によって実装された（ReasonSiteでの採用はテンプレートも編集された）ため、既にGitHubには変更が反映されている。</p>

<!-- PBSEARCH_RESULT -->
        </article>
    </section>
    <footer id="InfoFooter">
      <ul>
        <li>© Masaki Haruka 2003.</li>
        <li>Generated by <a href="https://gitlab.com/reasonset/pbsimply-wpimporter">PureBuilder Simply WP Importer</a></li>
      </ul>
    </footer>
  </body>
</html>
