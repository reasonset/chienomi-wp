<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="PureBuilder Simply WP Importer" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <meta name="author" content="Masaki Haruka" />
    <meta name="date" content="2015-07-12T00:00:00+09:00" />
    <meta name="dcterms.date" content="2015-07-12T00:00:00+09:00" />
    <title>PureBuilder2 - Chienomi</title>
    <style type="text/css">article {
max-width: 1080px;
margin: auto;
}</style>
  </head>
  <body>

    <section id="ContentContainer">
      <header id="MainHeader"><a href="/"><h1>Chienomi</h1></a></header>
      <section id="ArticleBox">
        <header id="ArticleTitle"><h1>PureBuilder2</h1></header>
        <article id="MainArticle">
<h3 id="purebuilder2とは">PureBuilder2とは</h3>
<p>PureBuilder2は現行のPureBuilderを置き換える新しいサイトビルドツールだ。 コマンド一発でウェブサイトの更新が可能になる。「動的生成の事前作業化」が可能となる。</p>
<p>PureBuilderからの主な変更点は次の通り</p>
<ul>
<li>Rubyでの実装 (Windowsで動作可能に)</li>
<li>MarkdownとeRuby対応</li>
</ul>
<p>変更点は少ないようにみえるが、PrueBuilderとは互換性はないし、コードも新規に起こす。</p>
<h3 id="markdownへの対応">Markdownへの対応</h3>
<p>Markdownへの対応はKramdownライブラリを使用した。 非常に使いやすく、問題はないように見えた。 何を何に出力するかは、指定クラスの入れ替えによるポリモーフィズムによる。</p>
<p>このラッパークラスはごく簡単だと思ったのだが、そうはいかなかった。</p>
<p>現状、PureDocはライブラリであり、ドキュメントがRubyコードである。 これを出力するためのユーティリティはZshスクリプトになっている。</p>
<p>PureBuilderはその多くをPureDocに依存している。 PureBuilderが直接に依存していなくても、テンプレート側はPureDocオブジェクトを触れることになっているし、現状テンプレートを呼ぶところまでがPureBuilderの仕事なので、当然テンプレートではドキュメントを出力するために、PureDocオブジェクトを必要とする。</p>
<p>だが、当然ながらKramdownオブジェクトはPureDocオブジェクトと互換性がない。 機能を維持するためには、単にKramdownを呼び出すラッパーではなく、Kramdownを内部で使うPureDoc互換クラスが必要となる。</p>
<p>予定とは比べ物にならないほど大変な作業だ。</p>
<h3 id="puredocのインターフェイス">PureDocのインターフェイス</h3>
<p>加えて、今のところPureDoc Translatorが保持している機能については、PureBuilderから使用することができなくなる。 旧来のPureBuilderは、コマンドとしてPureDoc Translatorを呼んでいたため問題がなかったが、ライブラリとして使うとTranslatorは使えない。</p>
<p>PureDocにその機能があるにはかかわらずPureDocに組み込まれていないのは、PureDocの仕様によるものだ。</p>
<p>PureDocの</p>
<pre><code>##-----
...
##-----</code></pre>
<p>という形式でYAMLをヘッダーとして埋め込めるという仕様は、PureDocにはないが、便宜上の拡張としてTraslatorにあり、PureBuilderはそれを前提として使用する。</p>
<p>これをPureDocに組み込むのであれば、<code>PureDoc</code>クラスにその機能をいれてしまえば良い。 要はこの仕様をPureDocに取り込むか、PureBuilderに取り込むかの話なのだが、おそらくはPureDocに取り込むのが妥当なところ。</p>
<p>一方同じようにこのヘッダを取り扱いながら、ヘッダにLast UpdateとSinceを書き込む機能があったりするが、これはあきらかにPureDocではなくPureBuilderに実装されるべき機能だ。</p>
<p>一応、いまのところ次の方針を考えている。</p>
<ul>
<li>meta取り込みは<code>PureDoc#read_meta(text)</code>で行う。このヘッダはコメントになっているので、テキストを与える必要がある。これはPureDocライブラリが勝手に実行することはない</li>
<li>PureBuilderは<code>puredoc.meta</code>により<code>since</code>と<code>last-update</code>を確認し、ない場合は追記する</li>
</ul>
<h3 id="purebuilder2のおおまかなモデル">PureBuilder2のおおまかなモデル</h3>
<p>purebuilder本体はRubyライブラリとなり、基本的には各ディレクトリの.rebuild_rulesまたは.up*ファイルが処理手順となる。</p>
<p>これらをまとめて呼ぶためのスクリプトが、purebuilder.rebuildallになる。</p>
<p>対象ファイルに対して</p>
<pre><code>PureBuilder.build(file, outputdir, extname)</code></pre>
<p>とすることでビルドできる形だ。</p>
<h3 id="インタープリタ起動役は">インタープリタ起動役は</h3>
<p>rebuildallでrebuildスクリプトのインタープリタは拡張子によって判断するが、拡張子がない場合は<code>perl</code>を使う。</p>
<p>これは、perlはshebang行を解釈するためだ。この機能はsh/bash/zsh/rubyにないことを確認している。 Perlは「Shebangを解釈できないダメなシェルに代わって」起動するそうだが、どうやらLinuxが解釈するだけで、シェルに解釈を期待するのは厳しそうだ。</p>

<!-- PBSEARCH_RESULT -->
        </article>
    </section>
    <footer id="InfoFooter">
      <ul>
        <li>© Masaki Haruka 2003.</li>
        <li>Generated by <a href="https://gitlab.com/reasonset/pbsimply-wpimporter">PureBuilder Simply WP Importer</a></li>
      </ul>
    </footer>
  </body>
</html>
