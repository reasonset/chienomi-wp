<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="PureBuilder Simply WP Importer" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <meta name="author" content="Masaki Haruka" />
    <meta name="date" content="2016-05-23T00:00:00+09:00" />
    <meta name="dcterms.date" content="2016-05-23T00:00:00+09:00" />
    <title>様々なブラウザと様々なプロファイルを切り替えて使うスクリプト - Chienomi</title>
    <style type="text/css">article {
max-width: 1080px;
margin: auto;
}</style>
  </head>
  <body>

    <section id="ContentContainer">
      <header id="MainHeader"><a href="/"><h1>Chienomi</h1></a></header>
      <section id="ArticleBox">
        <header id="ArticleTitle"><h1>様々なブラウザと様々なプロファイルを切り替えて使うスクリプト</h1></header>
        <article id="MainArticle">
<ul id="markdown-toc">
  <li><a href="#基本解説" id="markdown-toc-基本解説">基本解説</a></li>
  <li><a href="#Zsh Assoc" id="markdown-toc-Zsh Assoc">Zsh Assoc</a></li>
</ul>


<h3 id="基本解説">基本解説</h3>

<p><a href="https://github.com/reasonset/my-browser-profile-chooser">GitHub</a></p>

<p>これまでFirefox Latestスクリプトを使ってきたが、これではFirefoxしか利用できなかったり、異常終了やフリーズすると問題が生じる可能性があった。</p>

<p>Firefox Latestの仕組みは次のようなものだ。</p>

<p><a href="https://gist.github.com/reasonset/7a978e7cf2cf43eddc77ae0488e094cb">Gist</a></p>

<script src="https://gist.github.com/reasonset/7a978e7cf2cf43eddc77ae0488e094cb.js"></script>

<p>要はシンボリックリンクで.mozillaを切り替えて起動→終了したらシンボリックリンク修正、をしているだけだ。</p>

<p>ちなみに、もともとはMageiaがFirefoxをLTS版を採用していて、それが気に入らなかったのでこのようにしている。
だが、Manjaroはその必要はないので、Firefoxだけでなく、任意のブラウザを任意のプロファイルで起動できるようなスクリプトを書いた。</p>

<p>多くの関数が定義されているが、まずはプロファイル切り替えの方法をまとめる必要があった。</p>

<p>Chromium系は<code>--user-data-dir</code>オプションを使用する。</p>

<p>これに該当するのは</p>

<ul>
  <li>Google Chrome</li>
  <li>Chromium</li>
  <li>Opera (Blink系)</li>
  <li>Vivaldi</li>
  <li>SRWare Iron</li>
  <li>Maxthon</li>
</ul>

<p>Maxthon for LinuxはあまりにもOUT OF DATEが過ぎるが。</p>

<p>Firefox系は<code>-P profile</code>か<code>-profile path</code>のふたつ。設定全体を切り替えることはできず、プロファイルのみの保存切り替えだが、問題はあまりなさそうだった。これに該当するのは</p>

<ul>
  <li>Firefox</li>
  <li>SeaMonkey</li>
  <li>Palemoon</li>
</ul>

<p>それ以外</p>

<ul>
  <li>Midoriは<code>-c directory</code></li>
  <li>qupzillaは<code>-p directory</code></li>
  <li>Rekonqは<code>--config directory</code></li>
</ul>

<p>この5タイプに対応した上で、それぞれのブラウザに対応した関数を用意し、簡単に起動できるようにしている。</p>

<p>例えば</p>

<pre><code>mybrowsers[shopping]="chr $HOME/.browser-settings/chromium/shopping"
</code></pre>

<p>とした上で、</p>

<pre><code>$ mybrowser.zsh shopping
</code></pre>

<p>とすれば、<code>$HOME/.browser-settings/chromium/shopping</code>を設定ディレクトリとしてChromiumが起動することになる。</p>

<h3 id="Zsh Assoc">Zsh Assoc</h3>

<p>今回のスクリプトではZshの連想配列を2つ使用している。</p>

<p>ひとつは、ブラウザの起動設定を行うためのものだ。これは</p>

<pre><code>eval "$mybrowsers[$1]"
</code></pre>

<p>という部分で作用している。</p>

<p>もうひとつは、ブラウザのコマンドを修正するものだ。Chromeは<code>google-chrome</code>だったりするかと思うが、Archでは<code>google-chrome-stable</code>だったりもする。</p>

<p>そこでこれを修正するため、ブラウザの各コマンドは<code>"${${modify_browsers[$browser]}:-$browser}"</code>とすることで修正可能にした。</p>

<!-- PBSEARCH_RESULT -->
        </article>
    </section>
    <footer id="InfoFooter">
      <ul>
        <li>© Masaki Haruka 2003.</li>
        <li>Generated by <a href="https://gitlab.com/reasonset/pbsimply-wpimporter">PureBuilder Simply WP Importer</a></li>
      </ul>
    </footer>
  </body>
</html>
