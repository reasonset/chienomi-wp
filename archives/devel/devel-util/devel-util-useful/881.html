<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="PureBuilder Simply WP Importer" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <meta name="author" content="Masaki Haruka" />
    <meta name="date" content="2016-03-12T00:00:00+09:00" />
    <meta name="dcterms.date" content="2016-03-12T00:00:00+09:00" />
    <title>サイト構築で画像関連機能 - Chienomi</title>
    <style type="text/css">article {
max-width: 1080px;
margin: auto;
}</style>
  </head>
  <body>

    <section id="ContentContainer">
      <header id="MainHeader"><a href="/"><h1>Chienomi</h1></a></header>
      <section id="ArticleBox">
        <header id="ArticleTitle"><h1>サイト構築で画像関連機能</h1></header>
        <article id="MainArticle">
<ul id="markdown-toc">
  <li><a href="#section" id="markdown-toc-section">ウォーターマークをいれた画像を半自動で用意する</a></li>
  <li><a href="#figbaseuri" id="markdown-toc-figbaseuri">@figbaseuriの不完全さ</a></li>
  <li><a href="#lightbox" id="markdown-toc-lightbox">LightBox</a></li>
</ul>

<h3 id="section">ウォーターマークをいれた画像を半自動で用意する</h3>

<p><a href="https://gist.github.com/reasonset/c8ddd935e5561d2bc1b8">Gist</a></p>

<script src="https://gist.github.com/reasonset/c8ddd935e5561d2bc1b8.js"></script>

<p>ウォーターマークのベースはさすがに自動生成できるレベルにはなかったので、Inkscapeで作成した。
縦と横の二種類を用意している。</p>

<p>fig/にはオリジナルサイズの、thumb/にはサムネイルサイズの画像を配置するが、この時にcompositeを使ってウォーターマークを合成している。</p>

<p>また、幅1600pxを越える画像はリサイズしている。</p>

<h3 id="figbaseuri">@figbaseuriの不完全さ</h3>

<p>PureDocにもわずかな変更を加えたが、これは<code>attr</code>を排除するためにすぎない。</p>

<p>大きいのは<code>Parser::PureDoc</code>における</p>

<pre><code>        # Other settings for PureDoc
        begin
        if config[:purebuilder_config][:puredoc_tune].kind_of? Proc
          config[:purebuilder_config][:puredoc_tune].call(::DOC)
        end
        rescue
          STDERR.puts "!!ERROR in PureDoc TUNE:" + $!
        end
</code></pre>

<p>という変更だろう。</p>

<p>これによって、<code>@config[:puredoc_tune]</code>を使って各PureDocオブジェクトに対して設定が可能になった。
これはMarkdownドキュメントに対しては無効となる。</p>

<h3 id="lightbox">LightBox</h3>

<p><a href="https://gist.github.com/reasonset/4a72f188d8a731ae65d4">Gist</a></p>

<script src="https://gist.github.com/reasonset/4a72f188d8a731ae65d4.js"></script>

<p>「各article要素を取得してループ→各要素に対して各figure要素を取得してループ→イベントリスナー追加」という単純な構造ではある。</p>

<p>ライトボックス用に用意されたimg要素のsrcを変更し、さらに最大幅と最大高をウィンドウサイズに合わせてから表示する、という処理が追加され、ちゃんと機能するものになった。</p>

<p>figure要素に入っていないものはサムネイルの構造を持っていないとみなす方式。</p>

<!-- PBSEARCH_RESULT -->
        </article>
    </section>
    <footer id="InfoFooter">
      <ul>
        <li>© Masaki Haruka 2003.</li>
        <li>Generated by <a href="https://gitlab.com/reasonset/pbsimply-wpimporter">PureBuilder Simply WP Importer</a></li>
      </ul>
    </footer>
  </body>
</html>
