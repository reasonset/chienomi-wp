<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="PureBuilder Simply WP Importer" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <meta name="author" content="Masaki Haruka" />
    <meta name="date" content="2015-01-24T00:00:00+09:00" />
    <meta name="dcterms.date" content="2015-01-24T00:00:00+09:00" />
    <title>PureDoc:インデント機能、段落字数制限機能 - Chienomi</title>
    <style type="text/css">article {
max-width: 1080px;
margin: auto;
}</style>
  </head>
  <body>

    <section id="ContentContainer">
      <header id="MainHeader"><a href="/"><h1>Chienomi</h1></a></header>
      <section id="ArticleBox">
        <header id="ArticleTitle"><h1>PureDoc:インデント機能、段落字数制限機能</h1></header>
        <article id="MainArticle">

	<h3>段落字数制限</h3>
	<p>きちんと章立てせずにだらだら長い文章を書くことを抑制するために、指定した文字数を超える連続する段落がある場合警告する機能を搭載した。</p>
	<p>通常、段落はブロックによるan Arrayであるので、マークアップではなくPureDocクラスで面倒をみることにした。</p>
	<code style="display: block;white-space: pre-wrap">  # Paragraph element.
  # For notify length for too long flat text.
  def p(*text)
    
    text = block_given? ? yield : text
    
    if @par_length_limit
            
      if text.join.length &lt; @par_length_limit
	STDERR.puts "*WARNING : A single paragraph is too long (#{text.join.length} characters.)"
      end
    end
    
    return text

  end
	</code>
	<p>基本的な値の取得も面倒を見るようになった。</p>
	<p>制限文字数はユーザーが<tt class="puredoc_idname">@par_length_lumit</tt>を設定する。設定しなければ機能しない。</p>
	<h3>インデント</h3>
	<p>HTMLでの出力を基本としてきたため、いままで改行すら入れていなかったが、ちょっとひどいのでインデントも入れることにした。</p>
	<p>インデントの考え方としては、reading spaceを含めタグで始まる行をインデントする。このため、ネストしているものはこのインデント処理が複数呼ばれることになり、うまく処理できる。また、codeなどについては触らないようにできる。</p>
	<p>改行については各エレメントのフォーマッタで面倒をみる。といっても、大半はstdメタメソッドで作られているので触るところは少ない。さらに、<tt class="puredoc_idname">stringify</tt>メソッドによってインデント処理とともに<tt class="puredoc_idname">String</tt>化も行う。これにより、各エレメントは必ず文字列を返す、という仕様に統一された（これまでは文字列または配列を返していたが、<tt class="puredoc_idname">Array#to_s</tt>が変更された現在、その仕様は不適切となった）。</p>
	<p>ちなみに、<tt class="puredoc_idname">stringify</tt>に渡されてくる時点では文字列か配列かが確定できないので、これを処理して一旦文字列にしたあと（改行処理もする）、<tt class="puredoc_idname">String#each_line</tt>でインデントしてから、配列をまた文字列にしている。アルゴリズムとして効率はよくないが、開発を優先した。</p>
	<p>ちなみに、インデントは<tt class="puredoc_idname">@indent_spaces</tt>にセットするか、もしくは<tt class="puredoc_idname">$puredoc_indent_spaces</tt>環境変数にセットすることでコントロールできる。デフォルトはタブ文字ひとつである。</p>
	<p>これに伴って、要素はインラインかどうかを判定するためのキーワード引数が追加された。</p>
<!-- PBSEARCH_RESULT -->
        </article>
    </section>
    <footer id="InfoFooter">
      <ul>
        <li>© Masaki Haruka 2003.</li>
        <li>Generated by <a href="https://gitlab.com/reasonset/pbsimply-wpimporter">PureBuilder Simply WP Importer</a></li>
      </ul>
    </footer>
  </body>
</html>
